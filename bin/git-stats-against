#!/usr/bin/env bash

VERBOSE=
against="master"
while [ "$#" -gt "0" ]; do
  case "$1" in
    "-v")
      VERBOSE=true
      shift
      ;;
    "--against")
      against="$2"
      shift 2
      ;;
    *)
      break
      ;;
  esac
done

ref="HEAD"
if [ "$#" -eq "1" ]; then
  ref="$1"
fi

ancestor=`git merge-base ${ref} ${against}`
ahead_of_master=`git rev-list --count ${ancestor}..${ref}`
behind_master=`git rev-list --count ${ancestor}..${against}`

echo "${ref} is ${ahead_of_master} commits ahead of and ${behind_master} commits behind ${against}"

if [ ! -z "$VERBOSE" ]; then
  echo ""
  echo "New commits on ${ref} are:"
  git log --oneline --ancestry-path ${ancestor}..${ref}
fi

